# 物料图片功能说明

## 功能概述

为物料管理系统添加了图片上传、管理和展示功能，每个物料可以添加多个图片用于展示。

## 实现的功能

### 1. 数据库支持
- ✅ 创建了 `material_images` 表用于存储图片信息
- ✅ 支持图片路径、显示顺序和备注
- ✅ 自动关联物料ID，删除物料时自动删除关联图片

### 2. 数据模型更新
- ✅ `Material` 模型添加了 `images` 字段
- ✅ 支持图片列表的序列化和反序列化

### 3. 图片存储
- ✅ 图片文件存储在 `material_images` 目录下
- ✅ 自动生成唯一的文件名（格式：`material_{id}_{index}.{ext}`）
- ✅ 支持复制图片文件到指定目录

### 4. 用户界面
- ✅ 在物料编辑对话框中添加图片管理区域
- ✅ 支持添加多个图片
- ✅ 支持删除图片
- ✅ 支持查看图片（自动缩放适应窗口）
- ✅ 图片列表实时更新

### 5. 控制器功能
- ✅ `save_image()` - 保存图片文件
- ✅ `delete_image()` - 删除图片文件
- ✅ `get_material_images()` - 获取物料图片列表
- ✅ 创建和更新物料时自动处理图片

## 使用方法

### 添加物料图片

1. 点击"添加物料"或"编辑物料"按钮
2. 在对话框中找到"图片"区域
3. 点击"添加"按钮选择图片文件
4. 支持的文件格式：jpg, jpeg, png, gif, bmp
5. 可以选择多个图片
6. 点击"保存"按钮完成

### 查看图片

1. 在图片列表中选择要查看的图片
2. 点击"查看"按钮
3. 图片会在新窗口中打开，自动缩放适应窗口

### 删除图片

1. 在图片列表中选择要删除的图片
2. 点击"删除"按钮
3. 确认删除操作

## 文件结构

```
AutoInventory/
├── material_images/          # 图片存储目录（自动创建）
│   ├── material_1_0.jpg     # 物料1的第1张图片
│   ├── material_1_1.png     # 物料1的第2张图片
│   └── material_2_0.jpg     # 物料2的第1张图片
├── inventory.db              # 数据库文件
└── ...
```

## 数据库表结构

### material_images 表

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键 |
| material_id | INTEGER | 物料ID（外键） |
| image_path | TEXT | 图片文件路径 |
| display_order | INTEGER | 显示顺序 |
| notes | TEXT | 备注 |
| created_at | TIMESTAMP | 创建时间 |

## 技术实现

### 图片文件管理

```python
# 保存图片到物料目录
saved_path = material_controller.save_image(
    source_path="path/to/image.jpg",
    material_id=1,
    image_index=0
)

# 删除图片文件
material_controller.delete_image(image_path)
```

### 数据库操作

```python
# 添加图片记录
db.add_material_image(material_id, image_path, display_order)

# 获取物料图片列表
images = db.get_material_images(material_id)

# 删除物料的所有图片
db.delete_material_images(material_id)
```

## 注意事项

1. **文件格式**: 支持常见图片格式，推荐使用 jpg 或 png
2. **文件大小**: 建议单个图片不超过 5MB
3. **文件路径**: 图片文件保存在程序目录下的 `material_images` 文件夹
4. **删除物料**: 删除物料时会自动删除所有关联的图片文件和记录
5. **图片数量**: 建议每个物料不超过 10 张图片

## 依赖包

需要安装以下Python包：

```bash
pip install Pillow
```

Pillow 用于图片处理和显示。

## 故障排除

### 问题1：无法显示图片
- 检查是否安装了 Pillow: `pip install Pillow`
- 检查图片文件是否存在
- 检查图片格式是否支持

### 问题2：图片上传失败
- 检查文件路径是否正确
- 检查是否有写入权限
- 检查磁盘空间是否充足

### 问题3：图片不显示
- 检查图片路径是否完整
- 检查图片文件是否被移动或删除
- 尝试重新上传图片

## 更新日志

### v1.2 (当前版本)
- ✨ 新增物料图片上传功能
- ✨ 新增图片查看功能
- ✨ 新增图片删除功能
- 📁 自动创建图片存储目录
- 🔧 优化图片文件管理机制

